import{b as H,d as b}from"./QTable.6ea0b7e9.js";import{Q as C,a as y}from"./QTd.090e784f.js";import{b as D,S as v,d as J,a9 as w,ai as p,B as Q,v as s,t as a,m as o,z as K,a2 as I,q as u,y as r,ae as q,ad as A,k as f,C as V,D as S,Q as c,ah as U,bi as O,af as _,ag as W,ac as B,ab as x}from"./index.f9e4126b.js";import{Q as P}from"./QForm.c8ed59c7.js";import{Q as X}from"./QPagination.c3893f13.js";import{C as $}from"./ClosePopup.98bce5ba.js";import"./selection.bf6719bc.js";import"./QChip.40f28c3a.js";import"./format.3e32b8d9.js";const Y={id:"appointment"},Z={class:"q-pa-md"},ee={class:"control-btn"},te={class:"row"},le={class:"col-10"},ae={class:"col-2 confirm-btn"},ne=s("div",null," \u9810\u7D04\u78BA\u8A8D ",-1),oe={class:"row"},ie={class:"col-12"},de={class:"col-12"},se={class:"col-12"},ue={class:"col-12"},re=s("div",null,"\u4F60\u5373\u5C07\u522A\u9664\u8A72\u6D88\u606F",-1),we={__name:"AppointmentPage",setup(ce){const h=D(""),n=v([]),N=l=>l==="\u9810\u7D04\u7D50\u675F",T=()=>{for(let l=0;l<=n.length-1;l++)n[l].done===0?n[l].done="\u78BA\u8A8D\u5F8C\uFF0C\u8ACB\u9001\u51FA":n[l].done===1?n[l].done="\u9810\u7D04\u6210\u529F":n[l].done="\u9810\u7D04\u7D50\u675F"},k={required(l){return!!l||"\u6B04\u4F4D\u5FC5\u586B"}},z=v([{name:"account",label:"\u5E33\u865F",align:"left",field:l=>l.account},{name:"date",label:"\u9810\u7D04\u65E5\u671F",align:"left",field:l=>l.date},{name:"time",label:"\u9810\u7D04\u6642\u9593",align:"left",field:l=>l.time},{name:"p_name",label:"\u5925\u4F34\u540D\u5B57",align:"left",field:l=>l.p_name},{name:"place",label:"\u5730\u9EDE",align:"left",field:l=>l.place}]),g=D({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),M=J(()=>Math.ceil(n.length/g.value.rowsPerPage)),i=v({_id:"",account:"",date:"",time:"",p_name:"",place:"",done:"",dialog:!1}),m=v({dialog:!1,time:"",date:"",place:"",_id:""}),F=l=>{m.dialog=!0;const t=n.findIndex(e=>e._id===l);m._id=n[t]._id},R=l=>{const t=n.findIndex(e=>e._id===l);i._id=n[t]._id,i.account=n[t].account,i.date=n[t].date,i.time=n[t].time,i.p_name=n[t].p_name,i.place=n[t].place,i.dialog=!0},E=async()=>{try{const l=n.findIndex(t=>t._id===i._id);i.done=1,await w.patch("/users/appointment/"+i._id,i),n[l].done="\u9810\u7D04\u6210\u529F",p.fire({icon:"success",title:"\u6210\u529F",text:"\u9810\u7D04\u6210\u529F"})}catch{p.fire({icon:"error",title:"\u5931\u6557",text:"\u9810\u7D04\u5931\u6557"})}i.dialog=!1},L=async()=>{try{await w.patch("/backstages/appointmentDelete/"+m._id,m);const l=n.findIndex(t=>t._id===m._id);n.splice(l,1),p.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u9810\u7D04\u6210\u529F"})}catch{p.fire({icon:"error",title:"\u5931\u6557",text:"\u522A\u9664\u9810\u7D04\u5931\u6557"})}m.dialog=!1},j=async l=>{const t=n.findIndex(e=>e._id===l);n[t].u_replyStatus=1;try{await w.post("/users/replyAppointment/"+n[t]._id,{u_reply:n[t].u_reply,u_replyStatus:n[t].u_replyStatus,p_id:n[t].p_id}),p.fire({icon:"success",title:"\u6210\u529F",text:"\u56DE\u8986\u6210\u529F"})}catch{p.fire({icon:"error",title:"\u5931\u6557",text:"\u56DE\u8986\u5931\u6557"})}},G=l=>{const t=n.findIndex(e=>e._id===l);n[t].u_reply=""};return(async()=>{var l,t;try{const{data:e}=await w.get("/users/appointment");e.result.reverse(),n.push(...e.result),T()}catch(e){p.fire({icon:"error",title:"\u5931\u6557",text:((t=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:t.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(l,t)=>(u(),Q("div",Y,[s("div",Z,[a(H,{title:"\u9810\u7D04\u7D00\u9304",rows:n,columns:z,pagination:g.value,"onUpdate:pagination":t[1]||(t[1]=e=>g.value=e),"hide-pagination":"",filter:h.value,"row-key":"_id"},{header:o(e=>[a(C,{props:e},{default:o(()=>[a(b,{"auto-width":"",class:"text-left"},{default:o(()=>[r("\u9810\u7D04\u72C0\u6CC1")]),_:1}),(u(!0),Q(q,null,A(e.cols,d=>(u(),f(b,{key:d.name,props:e},{default:o(()=>[r(V(d.label),1)]),_:2},1032,["props"]))),128)),a(b,{"auto-width":"",class:"text-left"}),a(b,{"auto-width":"",class:"text-left"},{default:o(()=>[r("\u7D66\u5C0F\u5925\u4F34\u56DE\u8986")]),_:1})]),_:2},1032,["props"])]),body:o(e=>[a(C,{props:e},{default:o(()=>[a(y,null,{default:o(()=>[r(V(e.row.done),1)]),_:2},1024),(u(!0),Q(q,null,A(e.cols,d=>(u(),f(y,{key:d.name,props:e},{default:o(()=>[r(V(d.value),1)]),_:2},1032,["props"]))),128)),s("td",ee,[e.row.done==="\u78BA\u8A8D\u5F8C\uFF0C\u8ACB\u9001\u51FA"?(u(),f(c,{key:0,icon:"fa-solid fa-pen-to-square",onClick:d=>R(e.row._id)},null,8,["onClick"])):S("",!0),e.row.done==="\u78BA\u8A8D\u5F8C\uFF0C\u8ACB\u9001\u51FA"?(u(),f(c,{key:1,icon:"fa-solid fa-trash",onClick:d=>F(e.row._id)},null,8,["onClick"])):S("",!0)]),a(y,{"auto-width":""},{default:o(()=>[N(e.row.done)?(u(),f(c,{key:0,size:"sm",color:"accent",round:"",dense:"",onClick:d=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["onClick","icon"])):S("",!0)]),_:2},1024)]),_:2},1032,["props"]),U(a(C,{props:e},{default:o(()=>[e.row.u_replyStatus===1?(u(),f(y,{key:0,colspan:"100%"},{default:o(()=>[r(V(e.row.u_reply),1)]),_:2},1024)):(u(),f(y,{key:1,colspan:"100%"},{default:o(()=>[a(P,{onSubmit:d=>j(e.row._id),onReset:d=>G(e.row._id)},{default:o(()=>[s("div",te,[s("div",le,[a(_,{type:"text",modelValue:e.row.u_reply,"onUpdate:modelValue":d=>e.row.u_reply=d,label:"\u56DE\u8986"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ae,[a(c,{type:"submit",label:"\u78BA\u8A8D\u56DE\u8986"}),a(c,{type:"reset",label:"\u53D6\u6D88\u56DE\u8986",onClick:d=>e.expand=!1},null,8,["onClick"])])])]),_:2},1032,["onSubmit","onReset"])]),_:2},1024))]),_:2},1032,["props"]),[[O,e.expand]])]),"top-right":o(()=>[a(_,{outlined:"",dense:"",debounce:"300",modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),placeholder:"Search"},{append:o(()=>[a(W,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]),a(X,{modelValue:g.value.page,"onUpdate:modelValue":t[2]||(t[2]=e=>g.value.page=e),color:"grey-8",max:K(M),size:"sm"},null,8,["modelValue","max"])]),a(I,{modelValue:i.dialog,"onUpdate:modelValue":t[7]||(t[7]=e=>i.dialog=e),persistent:"",class:"appointment-dialog"},{default:o(()=>[a(B,null,{default:o(()=>[a(x,{class:"appointment-title"},{default:o(()=>[ne]),_:1}),a(P,{onSubmit:E},{default:o(()=>[a(x,{class:"appointment-main"},{default:o(()=>[s("div",oe,[s("div",ie,[r("\u9810\u7D04\u65E5\u671F "),a(_,{outlined:"",modelValue:i.date,"onUpdate:modelValue":t[3]||(t[3]=e=>i.date=e),type:"text",rules:[k.required]},null,8,["modelValue","rules"])]),s("div",de,[r("\u6703\u54E1\u6642\u9593 "),a(_,{outlined:"",modelValue:i.time,"onUpdate:modelValue":t[4]||(t[4]=e=>i.time=e),type:"text",rules:[k.required]},null,8,["modelValue","rules"])]),s("div",se,[r("\u5925\u4F34\u540D\u5B57 "),a(_,{outlined:"",modelValue:i.p_name,"onUpdate:modelValue":t[5]||(t[5]=e=>i.p_name=e),type:"text",disable:""},null,8,["modelValue"])]),s("div",ue,[r("\u5730\u9EDE "),a(_,{outlined:"",modelValue:i.place,"onUpdate:modelValue":t[6]||(t[6]=e=>i.place=e),type:"text",rules:[k.required]},null,8,["modelValue","rules"])])])]),_:1}),a(x,{class:"appointment-btn"},{default:o(()=>[a(c,{type:"submit",label:"\u78BA\u8A8D"}),U(a(c,{label:"\u53D6\u6D88"},null,512),[[$]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(I,{modelValue:m.dialog,"onUpdate:modelValue":t[9]||(t[9]=e=>m.dialog=e),persistent:"",class:"deleteAppointment-dialog"},{default:o(()=>[a(B,null,{default:o(()=>[a(x,{class:"deleteAppointment-title"},{default:o(()=>[re]),_:1}),a(x,{class:"deleteAppointment-btn"},{default:o(()=>[a(c,{label:"\u78BA\u8A8D\u522A\u9664",onClick:t[8]||(t[8]=e=>L())}),U(a(c,{label:"\u53D6\u6D88\u522A\u9664"},null,512),[[$]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{we as default};
