import{b as F,d as g}from"./QTable.6ea0b7e9.js";import{Q as h,a as u}from"./QTd.090e784f.js";import{b as k,S as x,d as M,a9 as v,ai as p,B as b,v as _,t as l,m as n,z as q,a2 as R,q as d,y as r,ae as V,ad as Q,k as c,C as w,D as C,Q as m,ah as S,bi as E,af as B,ag as L,ac as W,ab as P}from"./index.f9e4126b.js";import{Q as j}from"./QForm.c8ed59c7.js";import{Q as G}from"./QPagination.c3893f13.js";import{C as H}from"./ClosePopup.98bce5ba.js";import"./selection.bf6719bc.js";import"./QChip.40f28c3a.js";import"./format.3e32b8d9.js";const J={id:"work"},K={class:"q-pa-md"},O={class:"row"},X={class:"col-10"},Y={class:"col-2 confirm-btn"},Z=_("div",null,"\u4F60\u78BA\u5B9A\u5B8C\u6210\u8A72\u9810\u7D04?",-1),ue={__name:"WorkPage",setup(ee){const y=k(""),o=x([]),I=t=>t==="\u5DF2\u7D50\u675F",U=()=>{for(let t=0;t<=o.length-1;t++)o[t].done===1?o[t].done="\u5F85\u8FA6\u9810\u7D04":o[t].done="\u5DF2\u7D50\u675F"},$=x([{name:"name",label:"\u6703\u54E1\u59D3\u540D",align:"left",field:t=>t.name},{name:"date",label:"\u9810\u7D04\u65E5\u671F",align:"left",field:t=>t.date},{name:"time",label:"\u9810\u7D04\u6642\u9593",align:"left",field:t=>t.time},{name:"phone",label:"\u96FB\u8A71",align:"left",field:t=>0+t.phone},{name:"place",label:"\u5730\u9EDE",align:"left",field:t=>t.place}]),f=k({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),A=M(()=>Math.ceil(o.length/f.value.rowsPerPage)),D=async t=>{const a=o.findIndex(e=>e._id===t);o[a].p_replyStatus=1;try{await v.post("/users/replyMember/"+o[a]._id,{p_reply:o[a].p_reply,p_replyStatus:o[a].p_replyStatus}),p.fire({icon:"success",title:"\u6210\u529F",text:"\u56DE\u8986\u6210\u529F"})}catch{p.fire({icon:"error",title:"\u5931\u6557",text:"\u56DE\u8986\u5931\u6557"})}},N=t=>{const a=o.findIndex(e=>e._id===t);o[a].u_reply=""},i=x({dialog:!1,done:"",_id:""}),T=t=>{i.dialog=!0;const a=o.findIndex(e=>e._id===t);i._id=o[a]._id},z=async()=>{const t=o.findIndex(a=>a._id===i._id);try{i.done=2,await v.patch("/users/finishAppointment/"+i._id,i),o[t].done="\u5DF2\u7D50\u675F",p.fire({icon:"success",title:"\u6210\u529F",text:"\u5B8C\u6210\u9810\u7D04"})}catch{p.fire({icon:"error",title:"\u5931\u6557",text:"\u5B8C\u6210\u9810\u7D04\u5931\u6557"})}i.dialog=!1};return(async()=>{var t,a;try{const{data:e}=await v.get("/users/workAppointment");e.result.reverse(),o.push(...e.result),U()}catch(e){p.fire({icon:"error",title:"\u5931\u6557",text:((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,a)=>(d(),b("div",J,[_("div",K,[l(F,{title:"\u5DE5\u4F5C\u9810\u7D04\u7D00\u9304",rows:o,columns:$,pagination:f.value,"onUpdate:pagination":a[1]||(a[1]=e=>f.value=e),"hide-pagination":"",filter:y.value,"row-key":"_id"},{header:n(e=>[l(h,{props:e},{default:n(()=>[l(g,{"auto-width":"",class:"text-left"},{default:n(()=>[r("\u5B8C\u6210\u6309\u9215")]),_:1}),l(g,{"auto-width":"",class:"text-left"},{default:n(()=>[r("\u9810\u7D04\u72C0\u6CC1")]),_:1}),(d(!0),b(V,null,Q(e.cols,s=>(d(),c(g,{key:s.name,props:e},{default:n(()=>[r(w(s.label),1)]),_:2},1032,["props"]))),128)),l(g,{"auto-width":"",class:"text-left"},{default:n(()=>[r("\u7D66\u7528\u6236\u7559\u8A00")]),_:1})]),_:2},1032,["props"])]),body:n(e=>[l(h,{props:e},{default:n(()=>[l(u,null,{default:n(()=>[e.row.done==="\u5F85\u8FA6\u9810\u7D04"?(d(),c(m,{key:0,icon:"fa-solid fa-check",onClick:s=>T(e.row._id)},null,8,["onClick"])):C("",!0)]),_:2},1024),l(u,null,{default:n(()=>[r(w(e.row.done),1)]),_:2},1024),(d(!0),b(V,null,Q(e.cols,s=>(d(),c(u,{key:s.name,props:e},{default:n(()=>[r(w(s.value),1)]),_:2},1032,["props"]))),128)),l(u,{"auto-width":""},{default:n(()=>[I(e.row.done)?(d(),c(m,{key:0,size:"sm",color:"accent",round:"",dense:"",onClick:s=>e.expand=!e.expand,icon:e.expand?"remove":"add"},null,8,["onClick","icon"])):C("",!0)]),_:2},1024)]),_:2},1032,["props"]),S(l(h,{props:e},{default:n(()=>[e.row.p_replyStatus===1?(d(),c(u,{key:0,colspan:"100%"},{default:n(()=>[r(w(e.row.p_reply),1)]),_:2},1024)):(d(),c(u,{key:1,colspan:"100%"},{default:n(()=>[l(j,{onSubmit:s=>D(e.row._id),onReset:s=>N(e.row._id)},{default:n(()=>[_("div",O,[_("div",X,[l(B,{type:"text",modelValue:e.row.p_reply,"onUpdate:modelValue":s=>e.row.p_reply=s,label:"\u56DE\u8986"},null,8,["modelValue","onUpdate:modelValue"])]),_("div",Y,[l(m,{type:"submit",label:"\u78BA\u8A8D\u56DE\u8986"}),l(m,{type:"reset",label:"\u53D6\u6D88\u56DE\u8986",onClick:s=>e.expand=!1},null,8,["onClick"])])])]),_:2},1032,["onSubmit","onReset"])]),_:2},1024))]),_:2},1032,["props"]),[[E,e.expand]])]),"top-right":n(()=>[l(B,{outlined:"",dense:"",debounce:"300",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),placeholder:"Search"},{append:n(()=>[l(L,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]),l(G,{modelValue:f.value.page,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value.page=e),color:"grey-8",max:q(A),size:"sm"},null,8,["modelValue","max"])]),l(R,{modelValue:i.dialog,"onUpdate:modelValue":a[4]||(a[4]=e=>i.dialog=e),persistent:"",class:"work-dialog"},{default:n(()=>[l(W,null,{default:n(()=>[l(P,{class:"work-title"},{default:n(()=>[Z]),_:1}),l(P,{class:"work-btn"},{default:n(()=>[l(m,{label:"\u78BA\u8A8D\u5B8C\u6210",onClick:a[3]||(a[3]=e=>z())}),S(l(m,{label:"\u5C1A\u672A\u5B8C\u6210"},null,512),[[H]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ue as default};
