import{S as m,b as w,d as N,a9 as p,ai as u,B as b,v as r,t as a,Q as d,m as n,z,a2 as h,ae as F,q as v,af as x,ag as T,ac as k,ab as g,y as Q,ah as C}from"./index.f9e4126b.js";import{Q as A}from"./QImg.33557102.js";import{b as E}from"./QTable.6ea0b7e9.js";import{Q as j}from"./QPagination.c3893f13.js";import{Q as G}from"./QForm.c8ed59c7.js";import{C as D}from"./ClosePopup.98bce5ba.js";import"./selection.bf6719bc.js";import"./QChip.40f28c3a.js";import"./format.3e32b8d9.js";const H={class:"q-pa-md",id:"pageMessageManage"},J={key:0},K={key:1},L={class:"row"},O={class:"col-12"},R={class:"col-12"},W=r("div",{class:"text-h6"},"\u4F60\u5373\u5C07\u522A\u9664\u8A72\u6D88\u606F",-1),ie={__name:"PageMessageManagePage",setup(X){const y={required(s){return!!s||"\u6B04\u4F4D\u5FC5\u586B"}},V=new Date,P=V.getDate(),I=V.getMonth()+1,o=m([]),f=w(""),U=m([{name:"date",label:"\u65E5\u671F",align:"left",field:s=>s.date},{name:"title",label:"\u4E3B\u984C",align:"left",field:s=>s.title},{name:"content",label:"\u5167\u5BB9",align:"left",field:s=>s.content},{name:"button",label:"",align:"left"}]),c=w({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),q=N(()=>Math.ceil(o.length/c.value.rowsPerPage)),l=m({_id:"",date:"",title:"",content:"",dialog:!1}),M=(s,t)=>{const e=o.findIndex(_=>_._id===t);s===0?(l._id="",l.title="",l.content="",l.dialog=!0):(l._id=o[e]._id,l.title=o[e].title,l.content=o[e].content,l.dialog=!0)},B=async()=>{try{if(l.date=`${I}\u6708${P}\u65E5`,l._id.length===0){const{data:s}=await p.post("/backstages/messages",l);o.push(s.result),u.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6D88\u606F\u6210\u529F"})}else{const s=o.findIndex(e=>e._id===l._id),{data:t}=await p.patch("/backstages/messages/"+l._id,l);o[s]=t.result,u.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6D88\u606F\u6210\u529F"})}}catch{u.fire({icon:"error",title:"\u5931\u6557",text:"\u65B0\u589E\u6D88\u606F\u5931\u6557"})}l.dialog=!1},i=m({dialog:!1,content:"",title:"",_id:""}),$=s=>{i.dialog=!0;const t=o.findIndex(e=>e._id===s);i._id=o[t]._id},S=async()=>{const s=o.findIndex(t=>t._id===l._id);try{await p.patch("/backstages/messagesDelete/"+i._id,i),o.splice(s,1),u.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6D88\u606F\u6210\u529F"})}catch{u.fire({icon:"error",title:"\u5931\u6557",text:"\u522A\u9664\u6D88\u606F\u5931\u6557"})}i.dialog=!1};return(async()=>{try{const{data:s}=await p.get("/backstages/messages");o.push(...s.result)}catch{u.fire({icon:"error",title:"\u5931\u6557",text:"\u8B80\u53D6\u6D88\u606F\u5931\u6557"})}})(),(s,t)=>(v(),b(F,null,[r("div",H,[a(d,{label:"\u65B0\u589E\u8A0A\u606F",onClick:t[0]||(t[0]=e=>M(0)),class:"add"}),a(E,{title:"\u9801\u9762\u6D88\u606F\u7BA1\u7406",rows:o,columns:U,pagination:c.value,"onUpdate:pagination":t[2]||(t[2]=e=>c.value=e),"hide-pagination":"",filter:f.value,"row-key":"_id"},{"body-cell-pic":n(e=>[r("td",null,[a(A,{src:e.row.pic,style:{height:"90px"}},null,8,["src"])])]),"body-cell-button":n(e=>[r("td",null,[a(d,{icon:"fa-solid fa-pen-to-square",onClick:_=>M(1,e.row._id)},null,8,["onClick"]),a(d,{icon:"fa-solid fa-trash",onClick:_=>$(e.row._id)},null,8,["onClick"])])]),"top-right":n(()=>[a(x,{outlined:"",dense:"",debounce:"300",modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),placeholder:"Search"},{append:n(()=>[a(T,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]),a(j,{modelValue:c.value.page,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value.page=e),color:"grey-8",max:z(q),size:"sm"},null,8,["modelValue","max"])]),a(h,{modelValue:l.dialog,"onUpdate:modelValue":t[6]||(t[6]=e=>l.dialog=e),persistent:"",class:"pageMessageManage-dialog"},{default:n(()=>[a(k,null,{default:n(()=>[a(g,{class:"pageMessageManage-title"},{default:n(()=>[l._id.length===0?(v(),b("div",J,"\u9801\u9762\u6D88\u606F\u65B0\u589E")):(v(),b("div",K,"\u9801\u9762\u6D88\u606F\u4FEE\u6539"))]),_:1}),a(G,{onSubmit:B},{default:n(()=>[a(g,{class:"pageMessageManage-main"},{default:n(()=>[r("div",L,[r("div",O,[Q("\u4E3B\u984C "),a(x,{outlined:"",modelValue:l.title,"onUpdate:modelValue":t[4]||(t[4]=e=>l.title=e),type:"text",rules:[y.required]},null,8,["modelValue","rules"])]),r("div",R,[Q("\u5167\u5BB9 "),a(x,{outlined:"",type:"textarea",modelValue:l.content,"onUpdate:modelValue":t[5]||(t[5]=e=>l.content=e),rules:[y.required]},null,8,["modelValue","rules"])])])]),_:1}),a(g,{class:"pageMessageManage-btn"},{default:n(()=>[a(d,{type:"submit",label:"\u78BA\u8A8D"}),C(a(d,{label:"\u53D6\u6D88"},null,512),[[D]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(h,{modelValue:i.dialog,"onUpdate:modelValue":t[8]||(t[8]=e=>i.dialog=e),persistent:"",class:"pageMessageDelete-dialog"},{default:n(()=>[a(k,null,{default:n(()=>[a(g,{class:"pageMessageDelete-title"},{default:n(()=>[W]),_:1}),a(g,{class:"pageMessageDelete-btn"},{default:n(()=>[a(d,{label:"\u78BA\u8A8D\u522A\u9664",onClick:t[7]||(t[7]=e=>S())}),C(a(d,{label:"\u53D6\u6D88\u522A\u9664"},null,512),[[D]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ie as default};
