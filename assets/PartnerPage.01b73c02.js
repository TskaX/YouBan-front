import{b as Q,S as _,d as D,a9 as y,ai as b,B as m,v as i,t as o,Q as f,m as r,z as I,a2 as N,q as u,ae as F,ad as $,C as A,k as C,af as c,ag as L,ac as z,ab as V,y as p,D as w,ah as E}from"./index.f9e4126b.js";import{Q as U}from"./QImg.33557102.js";import{b as T,c as M}from"./QTable.6ea0b7e9.js";import{Q as j}from"./QPagination.c3893f13.js";import{Q as G}from"./QFile.5123addc.js";import{Q as H}from"./QForm.c8ed59c7.js";import{C as J}from"./ClosePopup.98bce5ba.js";import{v as K}from"./index.5b9c3700.js";import"./selection.bf6719bc.js";import"./QChip.40f28c3a.js";import"./format.3e32b8d9.js";const O={id:"partner"},R={class:"q-pa-md"},W={key:0},X={key:1},Y={class:"row"},Z={key:0,class:"col-5"},ee={key:1,class:"col-1"},le={key:2,class:"col-5"},ae={class:"col-5"},te=i("div",{class:"col-1"},null,-1),oe={class:"col-5"},ne={class:"col-5"},ie=i("div",{class:"col-1"},null,-1),de={class:"col-5"},se={class:"col-5"},re=i("div",{class:"col-1"},null,-1),ue={class:"col-5"},pe={class:"col-11"},ce={class:"col-11"},me=i("br",null,null,-1),Ce={__name:"PartnerPage",setup(ge){const v=Q(""),n=_([]),d={required(a){return!!a||"\u6B04\u4F4D\u5FC5\u586B"},email(a){return K.isEmail(a)||"\u683C\u5F0F\u932F\u8AA4"},length(a){return a.length>=4&&a.length<=16||"\u9577\u5EA6\u70BA4~16\u500B\u82F1\u6578\u5B57"},phoneLength(a){return a.length===10||"\u624B\u6A5F\u865F\u78BC\u683C\u5F0F\u932F\u8AA4"}},q=["\u904B\u52D5","\u904A\u6232","\u901B\u8857","\u5403\u98EF","\u96FB\u5F71"],e=_({_id:"",account:"",password:"",name:"",email:"",phone:"",birth:"",word:"",hobby:"",category:[],pic:void 0,dialog:!1,partner:1,loading:!1}),x=(a,t)=>{if(a===0)e.account="",e._id="",e.password="",e.name="",e.email="",e.phone="",e.birth="",e.pic=void 0,e.dialog=!0,e.loading=!1,e.word="",e.hobby="",e.category=[];else{const l=n.findIndex(s=>s._id===t);e.account=n[l].account,e._id=n[l]._id,e.name=n[l].name,e.email=n[l].email,e.phone="0"+n[l].phone,e.birth=n[l].birth,e.pic=n[l].pic,e.dialog=!0,e.loading=!1,e.word=n[l].word,e.hobby=n[l].hobby,e.category=n[l].category}},P=_([{name:"account",label:"\u5E33\u865F",align:"left",field:a=>a.account},{name:"name",label:"\u59D3\u540D",align:"left",field:a=>a.name},{name:"birth",label:"\u751F\u65E5",align:"left",field:a=>a.birth},{name:"phone",label:"\u96FB\u8A71",align:"left",field:a=>"0"+a.phone},{name:"category",label:"\u985E\u5225",align:"left"},{name:"hobby",label:"\u8208\u8DA3",align:"left",field:a=>a.hobby},{name:"word",label:"\u7D66\u6703\u54E1\u7684\u8A71",align:"left",field:a=>a.word},{name:"email",label:"\u4FE1\u7BB1",align:"left",field:a=>a.email},{name:"pic",label:"\u7167\u7247",align:"left"},{name:"button",label:"",align:"left"}]),g=_({_id:"",available:""}),k=async(a,t)=>{const l=n.findIndex(s=>s._id===t);g._id=n[l]._id;try{a===1?(g.available=0,n[l].available=0,await y.patch("/backstages/available/"+g._id,g)):(g.available=1,n[l].available=1,await y.patch("/backstages/available/"+g._id,g))}catch{b.fire({icon:"error",title:"\u5931\u6557",text:"\u4FEE\u6539\u8A72\u7528\u6236\u986F\u793A\u5931\u6557\uFF0C\u8ACB\u78BA\u8A8D\u932F\u8AA4"})}},B=async()=>{e.loading=!0;const a=new FormData;a.append("_id",e._id),a.append("account",e.account),a.append("password",e.password),a.append("name",e.name),a.append("email",e.email),a.append("phone",e.phone),a.append("birth",e.birth),a.append("pic",e.pic),a.append("partner",e.partner),a.append("word",e.word),a.append("hobby",e.hobby);for(const t of e.category)a.append("category",t);try{if(e._id.length===0){const{data:t}=await y.post("/users/partner",a);n.push(t.result),b.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const t=n.findIndex(s=>s._id===e._id),{data:l}=await y.patch("/users/partner/"+e._id,a);n[t]=l.result,b.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}}catch{e._id.length===0?b.fire({icon:"error",title:"\u5931\u6557",text:"\u65B0\u589E\u5931\u6557"}):b.fire({icon:"error",title:"\u5931\u6557",text:"\u7DE8\u8F2F\u5931\u6557"})}e.dialog=!1},h=Q({sortBy:"name",descending:!1,page:1,rowsPerPage:5}),S=D(()=>Math.ceil(n.length/h.value.rowsPerPage));return(async()=>{try{const{data:a}=await y.get("/backstages/partner");n.push(...a.result)}catch{b.fire({icon:"error",title:"\u5931\u6557",text:"\u53D6\u5F97\u5925\u4F34\u8CC7\u6599\u5931\u6557"})}})(),(a,t)=>(u(),m("div",O,[i("div",R,[o(f,{label:"\u65B0\u589E\u5925\u4F34",onClick:t[0]||(t[0]=l=>x(0,null)),class:"add"}),o(T,{title:"\u5925\u4F34\u7BA1\u7406",rows:n,columns:P,pagination:h.value,"onUpdate:pagination":t[2]||(t[2]=l=>h.value=l),"hide-pagination":"",filter:v.value,"row-key":"_id"},{"body-cell-category":r(l=>[i("td",null,[(u(!0),m(F,null,$(l.row.category,s=>(u(),m("span",{key:s},A(s)+"\xA0\xA0",1))),128))])]),"body-cell-pic":r(l=>[i("td",null,[o(U,{src:l.row.pic,style:{height:"90px"}},null,8,["src"])])]),"body-cell-button":r(l=>[i("td",null,[o(f,{icon:"fa-solid fa-pen-to-square",onClick:s=>x(1,l.row._id)},null,8,["onClick"]),l.row.available===1?(u(),C(f,{key:0,icon:"fa-solid fa-eye",onClick:s=>k(1,l.row._id)},null,8,["onClick"])):(u(),C(f,{key:1,icon:"fa-solid fa-eye-slash",onClick:s=>k(0,l.row._id)},null,8,["onClick"]))])]),"top-right":r(()=>[o(c,{outlined:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=l=>v.value=l),placeholder:"Search"},{append:r(()=>[o(L,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]),o(j,{modelValue:h.value.page,"onUpdate:modelValue":t[3]||(t[3]=l=>h.value.page=l),color:"grey-8",max:I(S),size:"sm"},null,8,["modelValue","max"])]),o(N,{modelValue:e.dialog,"onUpdate:modelValue":t[14]||(t[14]=l=>e.dialog=l),persistent:"",class:"partner-dialog"},{default:r(()=>[o(z,null,{default:r(()=>[o(V,{class:"partner-title"},{default:r(()=>[e._id.length===0?(u(),m("div",W,"\u5925\u4F34\u8CC7\u6599\u65B0\u589E")):(u(),m("div",X,"\u5925\u4F34\u8CC7\u6599\u4FEE\u6539"))]),_:1}),o(H,{onSubmit:B},{default:r(()=>[o(V,{class:"partner-main"},{default:r(()=>[i("div",Y,[e._id.length===0?(u(),m("div",Z,[p("\u5E33\u865F "),o(c,{outlined:"",modelValue:e.account,"onUpdate:modelValue":t[4]||(t[4]=l=>e.account=l),type:"text",rules:[d.required,d.length]},null,8,["modelValue","rules"])])):w("",!0),e._id.length===0?(u(),m("div",ee)):w("",!0),e._id.length===0?(u(),m("div",le,[p("\u5BC6\u78BC "),o(c,{outlined:"",modelValue:e.password,"onUpdate:modelValue":t[5]||(t[5]=l=>e.password=l),type:"text",rules:[d.required,d.length]},null,8,["modelValue","rules"])])):w("",!0),i("div",ae,[p("\u59D3\u540D "),o(c,{outlined:"",modelValue:e.name,"onUpdate:modelValue":t[6]||(t[6]=l=>e.name=l),type:"text",rules:[d.required]},null,8,["modelValue","rules"])]),te,i("div",oe,[p("\u96FB\u8A71 "),o(c,{outlined:"",modelValue:e.phone,"onUpdate:modelValue":t[7]||(t[7]=l=>e.phone=l),type:"text",rules:[d.required,d.phoneLength]},null,8,["modelValue","rules"])]),i("div",ne,[p("\u751F\u65E5 "),o(c,{outlined:"",modelValue:e.birth,"onUpdate:modelValue":t[8]||(t[8]=l=>e.birth=l),type:"text",rules:[d.required]},null,8,["modelValue","rules"])]),ie,i("div",de,[p("\u985E\u5225 "),o(M,{outlined:"",modelValue:e.category,"onUpdate:modelValue":t[9]||(t[9]=l=>e.category=l),options:q,rules:[d.required],multiple:""},null,8,["modelValue","rules"])]),i("div",se,[p("\u8208\u8DA3 "),o(c,{outlined:"",modelValue:e.hobby,"onUpdate:modelValue":t[10]||(t[10]=l=>e.hobby=l),type:"text",rules:[d.required]},null,8,["modelValue","rules"])]),re,i("div",ue,[p("\u7D66\u6703\u54E1\u7684\u4E00\u53E5\u8A71 "),o(c,{outlined:"",modelValue:e.word,"onUpdate:modelValue":t[11]||(t[11]=l=>e.word=l),type:"text",rules:[d.required]},null,8,["modelValue","rules"])]),i("div",pe,[p("\u4FE1\u7BB1 "),o(c,{outlined:"",modelValue:e.email,"onUpdate:modelValue":t[12]||(t[12]=l=>e.email=l),type:"text",rules:[d.required,d.email]},null,8,["modelValue","rules"])]),i("div",ce,[p("\u7167\u7247 "),me,o(U,{src:e.pic,style:{height:"90px",width:"140px"}},null,8,["src"]),o(G,{filled:"",modelValue:e.pic,"onUpdate:modelValue":t[13]||(t[13]=l=>e.pic=l),label:"\u9023\u7D50\u7167\u7247\u4F4D\u5740"},null,8,["modelValue"])])])]),_:1}),o(V,{class:"partner-btn"},{default:r(()=>[o(f,{type:"submit",label:"\u78BA\u8A8D",loading:e.loading},null,8,["loading"]),E(o(f,{label:"\u53D6\u6D88",disabled:e.loading},null,8,["disabled"]),[[J]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ce as default};
