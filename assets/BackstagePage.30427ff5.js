import{Q as y}from"./QImg.33557102.js";import{b as w,S as f,d as B,a9 as b,ai as h,B as P,v as o,t as i,m as s,z as I,a2 as S,ae as D,q as _,Q as c,k,af as p,ag as F,ac as N,ab as V,y as g,ah as A}from"./index.f9e4126b.js";import{b as $}from"./QTable.6ea0b7e9.js";import{Q as z}from"./QPagination.c3893f13.js";import{Q as E}from"./QFile.5123addc.js";import{Q as L}from"./QForm.c8ed59c7.js";import{C as T}from"./ClosePopup.98bce5ba.js";import{v as M}from"./index.5b9c3700.js";import"./selection.bf6719bc.js";import"./QChip.40f28c3a.js";import"./format.3e32b8d9.js";const j={class:"q-pa-md",id:"setting"},G=o("div",null,"\u6703\u54E1\u8CC7\u6599\u4FEE\u6539",-1),H={class:"row"},J={class:"col-12"},K={class:"col-12"},O={class:"col-12"},R={class:"col-12"},W={class:"col-12"},X=o("br",null,null,-1),ue={__name:"BackstagePage",setup(Y){const v=w(""),n=f([]),r={required(t){return!!t||"\u6B04\u4F4D\u5FC5\u586B"},email(t){return M.isEmail(t)||"\u683C\u5F0F\u932F\u8AA4"},length(t){return t.length>=4&&t.length<=16||"\u9577\u5EA6\u70BA4~16\u500B\u82F1\u6578\u5B57"},phoneLength(t){return t.length===10||"\u624B\u6A5F\u865F\u78BC\u683C\u5F0F\u932F\u8AA4"}},a=f({_id:"",name:"",email:"",phone:"",birth:"",pic:void 0,dialog:!1,loading:!1}),d=f({_id:"",available:""}),x=async(t,l)=>{const e=n.findIndex(m=>m._id===l);d._id=n[e]._id;try{t===1?(d.available=0,n[e].available=0,await b.patch("/backstages/available/"+d._id,d)):(d.available=1,n[e].available=1,await b.patch("/backstages/available/"+d._id,d))}catch{h.fire({icon:"error",title:"\u5931\u6557",text:"\u4FEE\u6539\u8A72\u7528\u6236\u986F\u793A\u5931\u6557\uFF0C\u8ACB\u78BA\u8A8D\u932F\u8AA4"})}};function Q(t){const l=n.findIndex(e=>e._id===t);a._id=n[l]._id,a.name=n[l].name,a.email=n[l].email,a.phone="0"+n[l].phone,a.birth=n[l].birth,a.dialog=!0,a.pic=n[l].pic,a.loading=!1}const C=async()=>{const t=n.findIndex(e=>e._id===a._id);a.loading=!0;const l=new FormData;l.append("name",a.name),l.append("email",a.email),l.append("phone",a.phone),l.append("birth",a.birth),l.append("pic",a.pic);try{const{data:e}=await b.patch("/backstages/"+a._id,l);n[t]=e.result,h.fire({icon:"success",title:"\u6210\u529F",text:"\u4FEE\u6539\u6703\u54E1\u8CC7\u6599\u6210\u529F"})}catch{h.fire({icon:"error",title:"\u6210\u529F",text:"\u672A\u77E5\u554F\u984C\u767C\u751F\uFF0C\u8ACB\u806F\u7D61\u5BA2\u670D"})}a.dialog=!1},U=f([{name:"account",label:"\u5E33\u865F",align:"left",field:t=>t.account},{name:"name",label:"\u59D3\u540D",align:"left",field:t=>t.name},{name:"email",label:"\u4FE1\u7BB1",align:"left",field:t=>t.email},{name:"phone",label:"\u96FB\u8A71",align:"left",field:t=>"0"+t.phone},{name:"birth",label:"\u751F\u65E5",align:"left",field:t=>t.birth},{name:"pic",label:"\u7167\u7247",align:"left"},{name:"button",label:"",align:"left"}]),u=w({sortBy:"name",descending:!1,page:1,rowsPerPage:5}),q=B(()=>Math.ceil(n.length/u.value.rowsPerPage));return(async()=>{var t,l;try{const{data:e}=await b.get("/backstages");n.push(...e.result)}catch(e){h.fire({icon:"error",title:"\u5931\u6557",text:((l=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,l)=>(_(),P(D,null,[o("div",j,[i($,{title:"\u6703\u54E1\u7BA1\u7406",rows:n,columns:U,pagination:u.value,"onUpdate:pagination":l[1]||(l[1]=e=>u.value=e),"hide-pagination":"",filter:v.value,"row-key":"_id"},{"body-cell-pic":s(e=>[o("td",null,[i(y,{src:e.row.pic,style:{height:"90px"}},null,8,["src"])])]),"body-cell-button":s(e=>[o("td",null,[i(c,{icon:"fa-solid fa-pen-to-square",onClick:m=>Q(e.row._id)},null,8,["onClick"]),e.row.available===1?(_(),k(c,{key:0,icon:"fa-solid fa-eye",onClick:m=>x(1,e.row._id)},null,8,["onClick"])):(_(),k(c,{key:1,icon:"fa-solid fa-eye-slash",onClick:m=>x(0,e.row._id)},null,8,["onClick"]))])]),"top-right":s(()=>[i(p,{outlined:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),placeholder:"Search"},{append:s(()=>[i(F,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","pagination","filter"]),i(z,{modelValue:u.value.page,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value.page=e),color:"grey-8",max:I(q),size:"sm"},null,8,["modelValue","max"])]),i(S,{modelValue:a.dialog,"onUpdate:modelValue":l[8]||(l[8]=e=>a.dialog=e),persistent:"",class:"setting-dialog"},{default:s(()=>[i(N,null,{default:s(()=>[i(V,{class:"setting-title"},{default:s(()=>[G]),_:1}),i(L,{onSubmit:C},{default:s(()=>[i(V,{class:"setting-main"},{default:s(()=>[o("div",H,[o("div",J,[g("\u59D3\u540D "),i(p,{outlined:"",modelValue:a.name,"onUpdate:modelValue":l[3]||(l[3]=e=>a.name=e),type:"text",rules:[r.required]},null,8,["modelValue","rules"])]),o("div",K,[g("\u4FE1\u7BB1 "),i(p,{outlined:"",modelValue:a.email,"onUpdate:modelValue":l[4]||(l[4]=e=>a.email=e),type:"text",rules:[r.required,r.email]},null,8,["modelValue","rules"])]),o("div",O,[g("\u96FB\u8A71 "),i(p,{outlined:"",modelValue:a.phone,"onUpdate:modelValue":l[5]||(l[5]=e=>a.phone=e),type:"text",rules:[r.required,r.phoneLength]},null,8,["modelValue","rules"])]),o("div",R,[g("\u751F\u65E5 "),i(p,{outlined:"",modelValue:a.birth,"onUpdate:modelValue":l[6]||(l[6]=e=>a.birth=e),type:"text",rules:[r.required]},null,8,["modelValue","rules"])]),o("div",W,[g("\u7167\u7247 "),X,i(y,{src:a.pic,style:{height:"90px",width:"140px"}},null,8,["src"]),i(E,{filled:"",modelValue:a.pic,"onUpdate:modelValue":l[7]||(l[7]=e=>a.pic=e),label:"\u9023\u7D50\u7167\u7247\u4F4D\u5740"},null,8,["modelValue"])])])]),_:1}),i(V,{class:"setting-btn"},{default:s(()=>[i(c,{type:"submit",label:"\u78BA\u8A8D",loading:a.loading},null,8,["loading"]),A(i(c,{label:"\u53D6\u6D88",disabled:a.loading},null,8,["disabled"]),[[T]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ue as default};
