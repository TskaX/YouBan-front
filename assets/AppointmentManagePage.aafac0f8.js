import{b as q,S as _,d as D,a9 as x,ai as v,B as te,t,Q as u,v as s,m as o,z as h,a2 as I,q as U,af as f,ag as Q,k as P,D as M,ac as S,ab as y,y as b,ah as B}from"./index.f9e4126b.js";import{b as $}from"./QTable.6ea0b7e9.js";import{Q as A}from"./QPagination.c3893f13.js";import{Q as E}from"./QForm.c8ed59c7.js";import{C as N}from"./ClosePopup.98bce5ba.js";import"./selection.bf6719bc.js";import"./QChip.40f28c3a.js";import"./format.3e32b8d9.js";const ne={id:"appointment-manage"},oe={class:"q-pa-md today-appointment"},ie={class:"q-pa-md all-appointment"},de={class:"q-pa-md all-reply"},se=s("div",null,"\u4FEE\u6539\u9810\u7D04\u8CC7\u6599",-1),ue={class:"row"},re={class:"col-12"},pe={class:"col-12"},me={class:"col-12"},ce={class:"col-12"},fe={class:"col-12"},ge={class:"col-12"},_e=s("div",{class:"text-h6"},"\u4F60\u5373\u5C07\u522A\u9664\u8A72\u9810\u7D04",-1),ye=s("div",null,"\u7DE8\u8F2F\u7559\u8A00",-1),be={class:"row"},ve={class:"col-12"},Ve={class:"col-12"},Te={__name:"AppointmentManagePage",setup(xe){const V={required(a){return!!a||"\u6B04\u4F4D\u5FC5\u586B"}},T=a=>{const e=document.querySelector(".today-appointment"),l=document.querySelector(".all-appointment"),r=document.querySelector(".all-reply");a===0?(e.style.cssText="display: none",l.style.cssText="display: block",r.style.cssText="display: none"):a===1?(e.style.cssText="display: block",l.style.cssText="display: none",r.style.cssText="display: none"):(e.style.cssText="display: none",l.style.cssText="display: none",r.style.cssText="display: block")},g=q(""),i=_([]),d=_([]);let m=_([]);const n=_({_id:"",a_date:"",account:"",name:"",date:"",time:"",p_name:"",place:"",done:"",dialog:!1}),c=_({dialog:!1,time:"",date:"",place:"",_id:""}),p=_({dialog:!1,u_reply:"",p_reply:"",_id:""}),F=a=>{c.dialog=!0;const e=i.findIndex(l=>l._id===a);c._id=i[e]._id},j=a=>{c.dialog=!0;const e=d.findIndex(l=>l._id===a);c._id=d[e]._id},G=()=>{for(let a=0;a<=i.length-1;a++)i[a].done===1?i[a].done="\u5C1A\u672A\u5B8C\u6210":i[a].done="\u5DF2\u5B8C\u6210"},R=()=>{for(let a=0;a<=d.length-1;a++)d[a].done===1?d[a].done="\u5C1A\u672A\u5B8C\u6210":d[a].done="\u5DF2\u5B8C\u6210"},z=_([{name:"date",label:"\u9810\u7D04\u7D00\u9304\u65E5\u671F",align:"left",field:a=>a.a_date.substring(0,10)},{name:"member_account",label:"\u6703\u54E1\u5E33\u865F",align:"left",field:a=>a.account},{name:"member_name",label:"\u6703\u54E1\u540D\u5B57",align:"left",field:a=>a.name},{name:"date",label:"\u9810\u7D04\u65E5\u671F",align:"left",field:a=>a.date},{name:"time",label:"\u9810\u7D04\u6642\u9593",align:"left",field:a=>a.time},{name:"p_name",label:"\u5925\u4F34\u540D\u5B57",align:"left",field:a=>a.p_name},{name:"place",label:"\u5730\u9EDE",align:"left",field:a=>a.place},{name:"status",label:"\u9810\u7D04\u72C0\u6CC1",align:"left",field:a=>a.done},{name:"button",label:"",align:"left"}]),H=_([{name:"date",label:"\u9810\u7D04\u7D00\u9304\u65E5\u671F",align:"left",field:a=>a.a_date.substring(0,10)},{name:"member_account",label:"\u6703\u54E1\u5E33\u865F",align:"left",field:a=>a.account},{name:"member_name",label:"\u6703\u54E1\u540D\u5B57",align:"left",field:a=>a.name},{name:"date",label:"\u9810\u7D04\u65E5\u671F",align:"left",field:a=>a.date},{name:"time",label:"\u9810\u7D04\u6642\u9593",align:"left",field:a=>a.time},{name:"p_name",label:"\u5925\u4F34\u540D\u5B57",align:"left",field:a=>a.p_name},{name:"u_reply",label:"\u6703\u54E1\u7559\u8A00",align:"left",field:a=>a.u_reply},{name:"p_reply",label:"\u5925\u4F34\u7559\u8A00",align:"left",field:a=>a.p_reply},{name:"button",label:"",align:"left"}]),w=q({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),J=D(()=>Math.ceil(i.length/w.value.rowsPerPage)),k=q({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),K=D(()=>Math.ceil(d.length/k.value.rowsPerPage)),C=q({sortBy:"name",descending:!1,page:1,rowsPerPage:10}),L=D(()=>Math.ceil(m.length/C.value.rowsPerPage)),O=a=>{const e=i.findIndex(l=>l._id===a);n._id=i[e]._id,n.a_date=i[e].a_date,n.name=i[e].name,n.account=i[e].account,n.date=i[e].date,n.time=i[e].time,n.p_name=i[e].p_name,n.place=i[e].place,n.dialog=!0},X=a=>{const e=d.findIndex(l=>l._id===a);n._id=d[e]._id,n.a_date=d[e].a_date,n.name=d[e].name,n.account=d[e].account,n.date=d[e].date,n.time=d[e].time,n.p_name=d[e].p_name,n.place=d[e].place,n.dialog=!0},Y=a=>{const e=m.findIndex(l=>l._id===a);p._id=m[e]._id,p.u_reply=m[e].u_reply,p.p_reply=m[e].p_reply,p.dialog=!0},Z=async()=>{try{const a=i.findIndex(r=>r._id===n._id),e=d.findIndex(r=>r._id===n._id),{data:l}=await x.patch("/backstages/appointment/"+n._id,n);i[a]=l.result,d[e]=l.result,R(),v.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u9810\u7D04\u6210\u529F"})}catch{v.fire({icon:"error",title:"\u5931\u6557",text:"\u7DE8\u8F2F\u9810\u7D04\u5931\u6557"})}n.dialog=!1},ee=async()=>{const a=i.findIndex(l=>l._id===c._id),e=d.findIndex(l=>l._id===c._id);try{await x.patch("/backstages/appointmentDelete/"+c._id,c),i.splice(a,1),d.splice(e,1),v.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u9810\u7D04\u6210\u529F"})}catch{v.fire({icon:"error",title:"\u5931\u6557",text:"\u522A\u9664\u9810\u7D04\u5931\u6557"})}c.dialog=!1},le=async()=>{const a=m.findIndex(e=>e._id===p._id);try{const{data:e}=await x.patch("/backstages/editReply/"+p._id,p);m[a].u_reply=e.result.u_reply,m[a].p_reply=e.result.p_reply,v.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u7559\u8A00\u6210\u529F"})}catch{v.fire({icon:"error",title:"\u5931\u6557",text:"\u7DE8\u8F2F\u7559\u8A00\u5931\u6557"})}p.dialog=!1};return(async()=>{var a,e;try{const{data:l}=await x.get("/backstages/appointment"),{data:r}=await x.get("/backstages/TodayAppointment"),{data:W}=await x.get("/backstages/appointment");l.result.reverse(),r.result.reverse(),W.result.reverse(),i.push(...r.result),d.push(...l.result),m.push(...W.result),m=m.filter(ae=>ae.done===2),G(),R(),console.log(m)}catch(l){v.fire({icon:"error",title:"\u5931\u6557",text:((e=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:e.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(a,e)=>(U(),te("div",ne,[t(u,{class:"today add",label:"\u7576\u65E5\u9810\u7D04",onClick:e[0]||(e[0]=l=>T(1))}),t(u,{class:"done add",label:"\u6240\u6709\u9810\u7D04",onClick:e[1]||(e[1]=l=>T(0))}),t(u,{class:"reply-check add",label:"\u7559\u8A00\u7BA1\u7406",onClick:e[2]||(e[2]=l=>T(-1))}),s("div",oe,[t($,{title:"\u9810\u7D04\u7BA1\u7406 - \u7576\u65E5\u9810\u7D04",rows:i,columns:z,pagination:w.value,"onUpdate:pagination":e[4]||(e[4]=l=>w.value=l),"hide-pagination":"",filter:g.value,"row-key":"_id"},{"top-right":o(()=>[t(f,{outlined:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),placeholder:"Search"},{append:o(()=>[t(Q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-button":o(l=>[s("td",null,[l.row.done!=="\u5DF2\u5B8C\u6210"?(U(),P(u,{key:0,icon:"fa-solid fa-pen-to-square",onClick:r=>O(l.row._id)},null,8,["onClick"])):M("",!0),l.row.done!=="\u5C1A\u672A\u5B8C\u6210"?(U(),P(u,{key:1,icon:"fa-solid fa-pen-to-square",style:{color:"white"},disable:""})):M("",!0),t(u,{icon:"fa-solid fa-trash",onClick:r=>F(l.row._id)},null,8,["onClick"])])]),_:1},8,["rows","columns","pagination","filter"]),t(A,{modelValue:w.value.page,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value.page=l),color:"grey-8",max:h(J),size:"sm"},null,8,["modelValue","max"])]),s("div",ie,[t($,{title:"\u9810\u7D04\u7BA1\u7406 - \u6240\u6709\u9810\u7D04",rows:d,columns:z,pagination:k.value,"onUpdate:pagination":e[7]||(e[7]=l=>k.value=l),"hide-pagination":"",filter:g.value,"row-key":"_id"},{"top-right":o(()=>[t(f,{outlined:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=l=>g.value=l),placeholder:"Search"},{append:o(()=>[t(Q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-button":o(l=>[s("td",null,[l.row.done!=="\u5DF2\u5B8C\u6210"?(U(),P(u,{key:0,icon:"fa-solid fa-pen-to-square",onClick:r=>X(l.row._id)},null,8,["onClick"])):M("",!0),l.row.done!=="\u5C1A\u672A\u5B8C\u6210"?(U(),P(u,{key:1,icon:"fa-solid fa-pen-to-square",style:{color:"white"},disable:""})):M("",!0),t(u,{icon:"fa-solid fa-trash",onClick:r=>j(l.row._id)},null,8,["onClick"])])]),_:1},8,["rows","columns","pagination","filter"]),t(A,{modelValue:k.value.page,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value.page=l),color:"grey-8",max:h(K),size:"sm"},null,8,["modelValue","max"])]),s("div",de,[t($,{title:"\u9810\u7D04\u7BA1\u7406 - \u7559\u8A00\u7D00\u9304",rows:h(m),columns:H,pagination:C.value,"onUpdate:pagination":e[10]||(e[10]=l=>C.value=l),"hide-pagination":"",filter:g.value,"row-key":"_id"},{"top-right":o(()=>[t(f,{outlined:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=l=>g.value=l),placeholder:"Search"},{append:o(()=>[t(Q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-button":o(l=>[s("td",null,[t(u,{icon:"fa-solid fa-pen-to-square",onClick:r=>Y(l.row._id)},null,8,["onClick"])])]),_:1},8,["rows","columns","pagination","filter"]),t(A,{modelValue:C.value.page,"onUpdate:modelValue":e[11]||(e[11]=l=>C.value.page=l),color:"grey-8",max:h(L),size:"sm"},null,8,["modelValue","max"])]),t(I,{modelValue:n.dialog,"onUpdate:modelValue":e[18]||(e[18]=l=>n.dialog=l),persistent:"",class:"appointmentManage-dialog"},{default:o(()=>[t(S,null,{default:o(()=>[t(y,{class:"appointmentManage-title"},{default:o(()=>[se]),_:1}),t(E,{onSubmit:Z},{default:o(()=>[t(y,{class:"appointmentManage-main"},{default:o(()=>[s("div",ue,[s("div",re,[b("\u6703\u54E1\u5E33\u865F "),t(f,{outlined:"",modelValue:n.account,"onUpdate:modelValue":e[12]||(e[12]=l=>n.account=l),type:"text",rules:[V.required],disable:""},null,8,["modelValue","rules"])]),s("div",pe,[b("\u6703\u54E1\u540D\u5B57 "),t(f,{outlined:"",modelValue:n.name,"onUpdate:modelValue":e[13]||(e[13]=l=>n.name=l),type:"text",rules:[V.required],disable:""},null,8,["modelValue","rules"])]),s("div",me,[b("\u9810\u7D04\u65E5\u671F "),t(f,{outlined:"",modelValue:n.date,"onUpdate:modelValue":e[14]||(e[14]=l=>n.date=l),type:"text",rules:[V.required]},null,8,["modelValue","rules"])]),s("div",ce,[b("\u6703\u54E1\u6642\u9593 "),t(f,{outlined:"",modelValue:n.time,"onUpdate:modelValue":e[15]||(e[15]=l=>n.time=l),type:"text",rules:[V.required]},null,8,["modelValue","rules"])]),s("div",fe,[b("\u5925\u4F34\u540D\u5B57 "),t(f,{outlined:"",modelValue:n.p_name,"onUpdate:modelValue":e[16]||(e[16]=l=>n.p_name=l),type:"text",rules:[V.required]},null,8,["modelValue","rules"])]),s("div",ge,[b("\u5730\u9EDE "),t(f,{outlined:"",modelValue:n.place,"onUpdate:modelValue":e[17]||(e[17]=l=>n.place=l),type:"text",rules:[V.required]},null,8,["modelValue","rules"])])])]),_:1}),t(y,{class:"appointmentManage-btn"},{default:o(()=>[t(u,{type:"submit",label:"\u78BA\u8A8D"}),B(t(u,{label:"\u53D6\u6D88"},null,512),[[N]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:c.dialog,"onUpdate:modelValue":e[20]||(e[20]=l=>c.dialog=l),persistent:"",class:"appointmentDelete-dialog"},{default:o(()=>[t(S,null,{default:o(()=>[t(y,{class:"appointmentDelete-title"},{default:o(()=>[_e]),_:1}),t(y,{class:"appointmentDelete-btn"},{default:o(()=>[t(u,{label:"\u78BA\u8A8D\u522A\u9664",onClick:e[19]||(e[19]=l=>ee())}),B(t(u,{label:"\u53D6\u6D88\u522A\u9664"},null,512),[[N]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(I,{modelValue:p.dialog,"onUpdate:modelValue":e[23]||(e[23]=l=>p.dialog=l),persistent:"",class:"appointmentManage-dialog"},{default:o(()=>[t(S,null,{default:o(()=>[t(y,{class:"appointmentManage-title"},{default:o(()=>[ye]),_:1}),t(E,{onSubmit:le},{default:o(()=>[t(y,{class:"appointmentManage-main"},{default:o(()=>[s("div",be,[s("div",ve,[b("\u6703\u54E1\u7559\u8A00 "),t(f,{outlined:"",modelValue:p.u_reply,"onUpdate:modelValue":e[21]||(e[21]=l=>p.u_reply=l),type:"text"},null,8,["modelValue"])]),s("div",Ve,[b("\u5925\u4F34\u7559\u8A00 "),t(f,{outlined:"",modelValue:p.p_reply,"onUpdate:modelValue":e[22]||(e[22]=l=>p.p_reply=l),type:"text"},null,8,["modelValue"])])])]),_:1}),t(y,{class:"appointmentManage-btn"},{default:o(()=>[t(u,{type:"submit",label:"\u78BA\u8A8D"}),B(t(u,{label:"\u53D6\u6D88"},null,512),[[N]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Te as default};
